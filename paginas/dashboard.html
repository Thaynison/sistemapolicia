<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="../styles/dashboard.css">
    <link rel="icon" href="../img/logo-pm.png">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel Policia - Dashboard</title>
</head>
<script>
    window.addEventListener('DOMContentLoaded', () => {
        const params = new URLSearchParams(window.location.search);
        const username = params.get('username');
        const userid = params.get('userid');
        const avatar = params.get('avatar');
        document.getElementById('username').textContent = username;
        document.getElementById('userid').textContent = userid;
        document.getElementById('avatar').src = avatar;
    });
</script>
<script>
    function getParams() {
        var params = {};
        window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi, function(m, key, value) {
            params[key] = value;
        });
        return params;
    }

    function loadUserInfo() {

        var params = getParams();
        var accessToken = params['access_token'];

        fetch('https://discord.com/api/v10/users/@me', {
            headers: {
                'Authorization': 'Bearer ' + accessToken
            }
        })
        .then(response => response.json())
        .then(data => {

            document.getElementById('username').textContent = data.username;
            document.getElementById('userid').textContent = data.id;
            document.getElementById('avatar').src = 'https://cdn.discordapp.com/avatars/' + data.id + '/' + data.avatar + '.png';
        })
        .catch(error => {
            console.error('Erro ao carregar informações do usuário:', error);
        });
    }

    window.onload = function() {
        loadUserInfo();
    };
</script>

<body>
    <div class="container">
        <div class="sidebar">
            <img class="img" src="../img/logo-pm.png" alt="">
            <h2 class="testing">Olá, <span id="username"></span>! <img class="avatar2" id="avatar" src="" alt="Avatar"></h2>
            <h2 style="display: none;">Olá, <span id="userid"></span>!</h2>
            <a href="#" class="button">Painel</a>
            <a href="#" class="button">Porte de Armas</a>
            <a href="#" class="button" onclick="redirecionarParaPrisao()">Sistema Prisional</a>
            <a href="#" class="button">Edital de Unidades</a>
            <a href="#" class="button">Cursos Online</a>
        </div>
        <div class="main-content">
            <div class="chart">
                <canvas id="pieChart" width="400" height="400"></canvas>
            </div>
            <div class="chart">
                <canvas id="lineChart" width="400" height="300"></canvas>
            </div>
            <div class="chart">
                <canvas id="foneChart" width="400" height="300"></canvas>
            </div>
        </div>
    </div>    
</body>
</html>

<script>
    function redirecionarParaPrisao() {
        const username = document.getElementById('username').textContent;
        const userid = document.getElementById('userid').textContent;
        const avatar = document.getElementById('avatar').src;

        window.location.href = `prisao.html?username=${encodeURIComponent(username)}&userid=${encodeURIComponent(userid)}&avatar=${encodeURIComponent(avatar)}`;
    }
</script>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    var slotsOcupados = 143;
    var slotsVazios = 500 - slotsOcupados;
    var slotsServico = getRandomInt(0, 30);
  
    var data = {
      labels: ['Oficias Registrados', 'Vagas Abertas', 'Em Serviço'],
      datasets: [{
        data: [slotsOcupados, slotsVazios, slotsServico],
        backgroundColor: ['#36a2eb', '#DAA520', '#008000'],
        hoverBackgroundColor: ['#36a2eb', '#DAA520', "#008000"]
      }]
    };

    var options = {
      responsive: true,
      maintainAspectRatio: false,
      legend: {
        position: 'bottom'
      },
      title: {
        display: true,
        text: 'Gráfico de Pizza'
      }
    };

    var ctx = document.getElementById('pieChart').getContext('2d');
    var myPieChart = new Chart(ctx, {
      type: 'pie',
      data: data,
      options: options
    });

    function getRandomInt(min, max) {
      return Math.floor(Math.random() * (max - min + 1)) + min;
    }

    setInterval(function() {
      slotsServico = getRandomInt(10, 20);
    }, 60000);
</script>
  

<script>

    function getRandomNumber(min, max) {
      return Math.floor(Math.random() * (max - min + 1)) + min;
    }

    function generateData() {
      var data = [];
      var crimeRate = 1;

      for (var i = 0; i < 12; i++) {
        crimeRate += getRandomNumber(-20, 40);
        data.push(crimeRate);
      }

      return data;
    }

    var data = {
      labels: ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun', 'Jul', 'Ago', 'Set', 'Out', 'Nov', 'Dez'],
      datasets: [{
        label: 'Movimentação de Crimes',
        data: generateData(),
        borderColor: '#DAA520',
        backgroundColor: 'transparent',
        pointBackgroundColor: '#ff6384',
        pointRadius: 4,
        pointHoverRadius: 6,
        pointHitRadius: 6,
        pointBorderWidth: 2,
        borderWidth: 2
      }]
    };

    var options = {
      responsive: true,
      maintainAspectRatio: false,
      legend: {
        position: 'top'
      },
      title: {
        display: true,
        text: 'Gráfico de Linhas - Movimentação de Crimes'
      },
      scales: {
        y: {
          beginAtZero: true,
          title: {
            display: true,
            text: 'Taxa de Crimes'
          }
        },
        x: {
          title: {
            display: true,
            text: 'Mês'
          }
        }
      }
    };

    var ctx = document.getElementById('lineChart').getContext('2d');
    var myLineChart = new Chart(ctx, {
      type: 'line',
      data: data,
      options: options
    });

</script>
<script>

    var data = {
      labels: ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun', 'Jul', 'Ago', 'Set', 'Out', 'Nov', 'Dez'],
      datasets: [{
        label: 'Cursos Realizados',
        data: [10, 12, 30, 20, 15, 2, 0, 0, 0, 0, 0, 0],
        backgroundColor: '#36a2eb',
        borderWidth: 0
      }]
    };

    var options = {
      responsive: true,
      maintainAspectRatio: false,
      legend: {
        display: false
      },
      title: {
        display: true,
        text: 'Gráfico de Barras - Cursos Realizados'
      },
      scales: {
        y: {
          beginAtZero: true,
          title: {
            display: true,
            text: 'Quantidade de Pessoas'
          }
        },
        x: {
          title: {
            display: true,
            text: 'Mês'
          }
        }
      }
    };

    var ctx = document.getElementById('foneChart').getContext('2d');
    var myBarChart = new Chart(ctx, {
      type: 'bar',
      data: data,
      options: options
    });
  </script>

  